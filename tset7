-- Freeze Trade Script GUI (Fixed Dragging)
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Get local player
local player = game.Players.LocalPlayer

-- Create the main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FreezeTradeGUI"
ScreenGui.Parent = game.CoreGui or player:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true

-- Main frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 220)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -110)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true

-- Outline
local Outline = Instance.new("UIStroke")
Outline.Color = Color3.fromRGB(60, 60, 70)
Outline.Thickness = 2
Outline.Parent = MainFrame

-- Rounded corners
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Title bar (for dragging)
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
TitleBar.BorderSizePixel = 0
TitleBar.ZIndex = 2
TitleBar.Active = true  -- Important for dragging
TitleBar.Selectable = true

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 10, 0, 0)
TitleBarCorner.Parent = TitleBar

-- Title bar outline
local TitleBarOutline = Instance.new("UIStroke")
TitleBarOutline.Color = Color3.fromRGB(70, 70, 80)
TitleBarOutline.Thickness = 1
TitleBarOutline.Parent = TitleBar

TitleBar.Parent = MainFrame

-- Title text
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "FREEZE TRADE"
Title.TextColor3 = Color3.fromRGB(220, 220, 230)
Title.TextSize = 16
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.ZIndex = 3
Title.Active = true
Title.Selectable = true
Title.Parent = TitleBar

-- Hide button
local HideButton = Instance.new("TextButton")
HideButton.Name = "HideButton"
HideButton.Size = UDim2.new(0, 30, 0, 30)
HideButton.Position = UDim2.new(1, -70, 0.5, -15)
HideButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
HideButton.BorderSizePixel = 0
HideButton.Text = "_"
HideButton.TextColor3 = Color3.fromRGB(220, 220, 230)
HideButton.TextSize = 18
HideButton.Font = Enum.Font.GothamBold
HideButton.ZIndex = 3

local HideButtonCorner = Instance.new("UICorner")
HideButtonCorner.CornerRadius = UDim.new(0, 6)
HideButtonCorner.Parent = HideButton

-- Hide button outline
local HideButtonOutline = Instance.new("UIStroke")
HideButtonOutline.Color = Color3.fromRGB(80, 80, 90)
HideButtonOutline.Thickness = 1
HideButtonOutline.Parent = HideButton

-- Close button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
CloseButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "×"
CloseButton.TextColor3 = Color3.fromRGB(220, 220, 230)
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.GothamBold
CloseButton.ZIndex = 3

local CloseButtonCorner = Instance.new("UICorner")
CloseButtonCorner.CornerRadius = UDim.new(0, 6)
CloseButtonCorner.Parent = CloseButton

-- Close button outline
local CloseButtonOutline = Instance.new("UIStroke")
CloseButtonOutline.Color = Color3.fromRGB(80, 80, 90)
CloseButtonOutline.Thickness = 1
CloseButtonOutline.Parent = CloseButton

HideButton.Parent = TitleBar
CloseButton.Parent = TitleBar

MainFrame.Parent = ScreenGui

-- Content area
local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Size = UDim2.new(1, -30, 1, -60)
Content.Position = UDim2.new(0, 15, 0, 50)
Content.BackgroundTransparency = 1
Content.Parent = MainFrame

-- Variables
local freezeEnabled = false
local acceptEnabled = false
local guiVisible = true

-- TOGGLE SECTION
local ToggleSectionLabel = Instance.new("TextLabel")
ToggleSectionLabel.Name = "ToggleSectionLabel"
ToggleSectionLabel.Size = UDim2.new(1, 0, 0, 25)
ToggleSectionLabel.Position = UDim2.new(0, 0, 0, 0)
ToggleSectionLabel.BackgroundTransparency = 1
ToggleSectionLabel.Text = "FEATURES:"
ToggleSectionLabel.TextColor3 = Color3.fromRGB(160, 160, 170)
ToggleSectionLabel.TextSize = 12
ToggleSectionLabel.Font = Enum.Font.GothamBold
ToggleSectionLabel.TextXAlignment = Enum.TextXAlignment.Left
ToggleSectionLabel.Parent = Content

-- Function to create toggle
local function createToggle(name, labelText, yPosition)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Name = name .. "ToggleFrame"
    ToggleFrame.Size = UDim2.new(1, 0, 0, 50)
    ToggleFrame.Position = UDim2.new(0, 0, 0, yPosition)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    ToggleFrame.BorderSizePixel = 0
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 8)
    ToggleCorner.Parent = ToggleFrame
    
    -- Toggle frame outline
    local ToggleFrameOutline = Instance.new("UIStroke")
    ToggleFrameOutline.Color = Color3.fromRGB(60, 60, 70)
    ToggleFrameOutline.Thickness = 1
    ToggleFrameOutline.Parent = ToggleFrame
    
    -- Toggle switch
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Name = "ToggleButton"
    ToggleButton.Size = UDim2.new(0, 55, 0, 28)
    ToggleButton.Position = UDim2.new(1, -65, 0.5, -14)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = ""
    ToggleButton.AutoButtonColor = false
    
    local ToggleButtonCorner = Instance.new("UICorner")
    ToggleButtonCorner.CornerRadius = UDim.new(1, 0)
    ToggleButtonCorner.Parent = ToggleButton
    
    -- Toggle button outline
    local ToggleButtonOutline = Instance.new("UIStroke")
    ToggleButtonOutline.Color = Color3.fromRGB(90, 90, 100)
    ToggleButtonOutline.Thickness = 1
    ToggleButtonOutline.Parent = ToggleButton
    
    -- Toggle circle
    local ToggleCircle = Instance.new("Frame")
    ToggleCircle.Name = "ToggleCircle"
    ToggleCircle.Size = UDim2.new(0, 22, 0, 22)
    ToggleCircle.Position = UDim2.new(0, 3, 0.5, -11)
    ToggleCircle.BackgroundColor3 = Color3.fromRGB(220, 220, 230)
    ToggleCircle.BorderSizePixel = 0
    
    local ToggleCircleCorner = Instance.new("UICorner")
    ToggleCircleCorner.CornerRadius = UDim.new(1, 0)
    ToggleCircleCorner.Parent = ToggleCircle
    
    -- Toggle circle outline
    local ToggleCircleOutline = Instance.new("UIStroke")
    ToggleCircleOutline.Color = Color3.fromRGB(40, 40, 45)
    ToggleCircleOutline.Thickness = 1
    ToggleCircleOutline.Parent = ToggleCircle
    
    ToggleCircle.Parent = ToggleButton
    
    -- Status text (ON/OFF)
    local StatusText = Instance.new("TextLabel")
    StatusText.Name = "StatusText"
    StatusText.Size = UDim2.new(0, 50, 0, 25)
    StatusText.Position = UDim2.new(1, -125, 0.5, -12.5)
    StatusText.BackgroundTransparency = 1
    StatusText.Text = "OFF"
    StatusText.TextColor3 = Color3.fromRGB(200, 100, 100)
    StatusText.TextSize = 12
    StatusText.Font = Enum.Font.GothamBold
    StatusText.TextXAlignment = Enum.TextXAlignment.Right
    StatusText.Parent = ToggleFrame
    
    -- Label
    local ToggleLabel = Instance.new("TextLabel")
    ToggleLabel.Name = "ToggleLabel"
    ToggleLabel.Size = UDim2.new(1, -140, 1, 0)
    ToggleLabel.Position = UDim2.new(0, 15, 0, 0)
    ToggleLabel.BackgroundTransparency = 1
    ToggleLabel.Text = labelText
    ToggleLabel.TextColor3 = Color3.fromRGB(220, 220, 230)
    ToggleLabel.TextSize = 14
    ToggleLabel.Font = Enum.Font.Gotham
    ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    ToggleLabel.Parent = ToggleFrame
    
    ToggleButton.Parent = ToggleFrame
    ToggleFrame.Parent = Content
    
    return ToggleFrame, ToggleButton, ToggleCircle, StatusText
end

-- Create toggles
local FreezeToggleFrame, FreezeToggleButton, FreezeToggleCircle, FreezeStatus = createToggle("Freeze", "Freeze victims screen", 35)
local AcceptToggleFrame, AcceptToggleButton, AcceptToggleCircle, AcceptStatus = createToggle("Accept", "Auto accept trade", 95)

-- Function to animate toggle with GREEN color
local function animateToggle(toggleButton, toggleCircle, statusText, isOn)
    if isOn then
        TweenService:Create(toggleCircle, TweenInfo.new(0.2), {
            Position = UDim2.new(1, -25, 0.5, -11)
        }):Play()
        TweenService:Create(toggleButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(80, 200, 80)
        }):Play()
        statusText.Text = "ON"
        statusText.TextColor3 = Color3.fromRGB(80, 220, 80)
    else
        TweenService:Create(toggleCircle, TweenInfo.new(0.2), {
            Position = UDim2.new(0, 3, 0.5, -11)
        }):Play()
        TweenService:Create(toggleButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(70, 70, 80)
        }):Play()
        statusText.Text = "OFF"
        statusText.TextColor3 = Color3.fromRGB(200, 100, 100)
    end
end

-- Toggle functionality
local function toggleFreeze()
    freezeEnabled = not freezeEnabled
    animateToggle(FreezeToggleButton, FreezeToggleCircle, FreezeStatus, freezeEnabled)
    print("[Freeze]", freezeEnabled and "✅ Enabled" or "❌ Disabled")
end

local function toggleAccept()
    acceptEnabled = not acceptEnabled
    animateToggle(AcceptToggleButton, AcceptToggleCircle, AcceptStatus, acceptEnabled)
    print("[Auto Accept]", acceptEnabled and "✅ Enabled" or "❌ Disabled")
end

-- Connect toggle clicks
FreezeToggleButton.MouseButton1Click:Connect(toggleFreeze)
AcceptToggleButton.MouseButton1Click:Connect(toggleAccept)

-- Button hover effects
local function setupButtonEffects(button, outline)
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        if outline then
            outline.Color = Color3.fromRGB(100, 100, 110)
        end
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        if outline then
            outline.Color = Color3.fromRGB(80, 80, 90)
        end
    end)
end

setupButtonEffects(HideButton, HideButtonOutline)
setupButtonEffects(CloseButton, CloseButtonOutline)

-- Hide/Show functionality
HideButton.MouseButton1Click:Connect(function()
    if guiVisible then
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 50, 0, 50)
        }):Play()
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Position = UDim2.new(1, -60, 0, 10)
        }):Play()
        
        HideButton.Text = "□"
        HideButton.Size = UDim2.new(0, 40, 0, 40)
        HideButton.Position = UDim2.new(0.5, -20, 0.5, -20)
        HideButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        
        guiVisible = false
    else
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 280, 0, 220)
        }):Play()
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Position = UDim2.new(0.5, -140, 0.5, -110)
        }):Play()
        
        HideButton.Text = "_"
        HideButton.Size = UDim2.new(0, 30, 0, 30)
        HideButton.Position = UDim2.new(1, -70, 0.5, -15)
        HideButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        
        guiVisible = true
    end
end)

-- Close button functionality
CloseButton.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {
        Position = UDim2.new(0.5, -140, 1.5, -110)
    }):Play()
    wait(0.3)
    ScreenGui:Destroy()
end)

-- ========================
-- FIXED DRAGGING SYSTEM
-- ========================
local dragging = false
local dragStart
local startPos
local isMobile = UserInputService.TouchEnabled

-- Make title bar and title text active for better dragging
TitleBar.Active = true
TitleBar.Selectable = true
Title.Active = true
Title.Selectable = true

-- Start dragging function
local function startDragging(input)
    if guiVisible then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        -- Capture input for mobile
        if isMobile then
            input:Capture()
        end
        
        -- Connection to handle input changed in real-time
        local connection
        connection = RunService.Heartbeat:Connect(function()
            if dragging then
                local currentInput = UserInputService:GetMouseLocation()
                if currentInput then
                    local delta = currentInput - dragStart
                    MainFrame.Position = UDim2.new(
                        startPos.X.Scale,
                        startPos.X.Offset + delta.X,
                        startPos.Y.Scale,
                        startPos.Y.Offset + delta.Y
                    )
                end
            else
                connection:Disconnect()
            end
        end)
    end
end

-- Stop dragging function
local function stopDragging()
    dragging = false
end

-- Set up input began for PC (MouseButton1) and Mobile (Touch)
local function setupDragInput(obj)
    obj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            startDragging(input)
        elseif isMobile and input.UserInputType == Enum.UserInputType.Touch then
            startDragging(input)
        end
    end)
    
    obj.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            stopDragging()
        elseif isMobile and input.UserInputType == Enum.UserInputType.Touch then
            stopDragging()
        end
    end)
end

-- Apply dragging to both TitleBar and Title
setupDragInput(TitleBar)
setupDragInput(Title)

-- Alternative method using UserInputService directly
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or 
       (isMobile and input.UserInputType == Enum.UserInputType.Touch) then
        stopDragging()
    end
end)

-- Also allow dragging by holding anywhere on the title area
MainFrame.InputBegan:Connect(function(input)
    -- Only allow dragging from top 40 pixels (title bar area)
    local relativeY = input.Position.Y - MainFrame.AbsolutePosition.Y
    if relativeY <= 40 then
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            startDragging(input)
        elseif isMobile and input.UserInputType == Enum.UserInputType.Touch then
            startDragging(input)
        end
    end
end)

MainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        stopDragging()
    elseif isMobile and input.UserInputType == Enum.UserInputType.Touch then
        stopDragging()
    end
end)

print("======================================")
print("FREEZE TRADE SCRIPT GUI LOADED!")
print("======================================")
print("✓ Light black theme with outlines")
print("✓ Green toggle effects when ON")
print("✓ FULLY DRAGGABLE (PC & Mobile)")
print("✓ Simple & clean design")
print("")
print("DRAGGING INSTRUCTIONS:")
print("PC: Click and hold TOP BAR, move mouse")
print("Mobile: Touch and hold TOP BAR, drag")
print("")
print("CONTROLS:")
print("- Drag: Click/Touch top bar")
print("- Hide: Click '_' button")
print("- Close: Click '×' button")
print("- Toggle: Click switches (turn GREEN)")
print("")
print("Test dragging NOW by clicking the top bar!")
print("======================================")
